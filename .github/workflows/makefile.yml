name: Makefile CI

on:
  push:

    paths:
 
      - scripts/**
      - .github/workflows/**
      
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:

    runs-on: ubuntu-latest
    

    steps:
    - uses: actions/checkout@v2
    - name: Run apt update
      run: sudo apt update 
      
    - name: Compile Hundalm
      uses: docker://pandoc/core:2.9
      with: >-  # allows you to break string into multiple line 
        -o=./descriptions/hundalm.html
        --toc
        -s
        --citeproc
        --top-level-division=section
        --bibliography=./bibliography/tanguy_bib.bib
        --csl="https://raw.githubusercontent.com/citation-style-language/styles/master/elsevier-harvard.csl"
        --metadata title="Hundalm Tropfstein- und Eish√∂hle"
        ./descriptions/hundalm.md
      

    - name: Build pages
      run: make -f ./scripts/make.make caves

    - name: Run check
      run: make check
      
    - name: Run distcheck
      run: make distcheck
